@using TodoSeUsa.Application.Features.Sales.DTOs
@using TodoSeUsa.Application.Features.Sales.Interfaces

@inject ISaleService SaleService;

@inject DialogService DialogService;

@attribute [Authorize]

<RadzenStack AlignItems="AlignItems.Center" JustifyContent="JustifyContent.Center" class="rz-mb-4">

    <RadzenText TextStyle="TextStyle.H6">
        Cancelar una venta implica la devolución de todos los productos y un reembolso de todos los pagos.
    </RadzenText>

    <RadzenText TextStyle="TextStyle.H6">
        ¿Estás seguro que deseas cancelar la venta código <b>'@SaleDto.Id'</b> (código público <b>'@SaleDto.Code'</b>) emitida el: <b>@SaleDto.DateIssued.ToString("D")?</b>
    </RadzenText>
</RadzenStack>

<RadzenCard Variant="Variant.Outlined" Style="border-color: red;" class="d-flex align-content-center align-items-center rz-mb-4">

    <RadzenIcon Icon="warning" IconStyle="IconStyle.Danger" Style="font-size: 2rem" class="me-1"></RadzenIcon>
    <RadzenText TextStyle="TextStyle.H6" Style="color:red; margin: 0">Ésta operación no se puede revertir</RadzenText>

</RadzenCard>

<RadzenStack Orientation="Orientation.Horizontal" 
             AlignItems="AlignItems.Center" 
             JustifyContent="JustifyContent.Center" 
             Gap="3rem" 
             Wrap="FlexWrap.Wrap">

    <RadzenButton IsBusy="_isCancelButtonBusy" Icon="cancel" Text="Cancelar" BusyText="Cancelando..." ButtonStyle="ButtonStyle.Danger" Size="ButtonSize.Large" Click="@Cancel" />

</RadzenStack>

@code
{
    [Parameter] public required DetailedSaleDto SaleDto { get; set; }

    private bool _isCancelButtonBusy = false;

    async Task Cancel()
    {
        if (SaleDto is null) return;

        _isCancelButtonBusy = true;
        var result = await SaleService.CancelByIdAsync(SaleDto.Id, null, CancellationToken.None);
        _isCancelButtonBusy = false;

        DialogService.Close(result);
    }
}